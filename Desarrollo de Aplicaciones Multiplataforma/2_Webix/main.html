<!DOCTYPE HTML>
<html>
 <head>
 <meta charset="UTF-8">
  <link rel="stylesheet" href="//cdn.webix.com/edge/webix.css" type="text/css"> 
  <script src="//cdn.webix.com/edge/webix.js" type="text/javascript"></script>  
 </head>
 <body>
   <script type="text/javascript" charset="utf-8">
webix.ui(
			{
				cols: [
					//forma
					{
						width: 300, view: 'form', id: 'forma', elements: [
							{ view: 'text', name: 'Nombre', id: 'Nombre', label: 'Nombre' },
							{ view: 'text', name: 'Telefono', id: 'Telefono', label: 'Telefono', labelWidth: 120, required: true },
							{ view: 'text', name: 'Edad', id: 'Edad', label: 'Edad' },
							{
								cols: [
									{ view: 'button', id: 'BotonNuevo', value: 'Nuevo', click: nuevo },
									{},
									{ view: 'button', id: 'BotonGuardar', value: 'Guardar', click: mostrar },
									{ view: 'button', id: 'BotonModificar', value: 'Modificar', click: modificar, hidden: true },
								]
							},
							{ view: 'button', id: 'Delete', value: 'Delete', click: borrar },
						]
					},
					//tabla
					{
						rows: [
							{
								view: "datatable", id: 'Tabla', select: "row", multiselect: true,
								columns: [
									{ id: "Nombre", header: ["Nombre", { content: "textFilter" }], width: 200, sort: 'string', fillspace: true },
									{ id: "Telefono", header: "Telefono", width: 80, sort: 'string' },
									{ id: "Edad", header: "Edad", width: 100, sort: 'int' }
								],
								url: "http://dapp.enlacenet.net:8088/buscar",
							}
						]
					}
				]
			}
		);
   
$$('forma').bind($$('Tabla'));

$$('Tabla').attachEvent("onAfterSelect", function(selection, preserve){
	$$('BotonModificar').show();
	$$('BotonGuardar').hide();
});

function mostrar() {
	// $$('Accion').setValue('Guardar');
	if($$('forma').validate()) {
		var valores = JSON.stringify($$('forma').getValues())
		alert(valores)
		webix.ajax().post('http://dapp.enlacenet.net:8088/guardar',{datos: valores}, 
		function() {
			$$('Tabla').clearAll();
			$$('Tabla').load('http://dapp.enlacenet.net:8088/buscar');
			$$('forma').clear();
		});
	}	
}

function borrar() {
	var idFilas = $$('Tabla').getSelectedId(true,true);
	webix.confirm('Estas seguro de eliminar las filas: ' + idFilas).then(function(resultado){
        if(resultado) {
        	webix.ajax().post('http://dapp.enlacenet.net:8088/borrar',
				{'Accion':'Borrar','id':idFilas},
				function() {
					$$('Tabla').clearAll();
					$$('Tabla').load('http://dapp.enlacenet.net:8088/buscar');
				}
        	);
        } 
    });
}

function nuevo() {
	$$('forma').clear();
	$$('BotonModificar').hide();
	$$('BotonGuardar').show();
}

function modificar() {
	$$('Accion').setValue('Modificar');
	if($$('forma').validate()) {
		webix.ajax().post('http://dapp.enlacenet.net:8088/modificar',$$('forma').getValues(), 
		function() {
			$$('Tabla').clearAll();
			$$('Tabla').load('http://dapp.enlacenet.net:8088/buscar');
			$$('forma').clear();
		});
	}
}

   </script>
 </body>
</html>